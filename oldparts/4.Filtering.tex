\section{Filtering and Beamforming}
\label{sec:filtering_beamforming}

Given the model and results obtained in \cref{sec:doa_ncm_estimation}, these can now be used to filter the observed signal, yielding an estimate of the desired signal at a reference sensor. Specifically, the previously acquired NCM and DoA information can be employed to design a filter that produces an improved output signal — preserving the desired component while minimizing the contamination.

To this end, a linear filter $\bvh[l,k]$ is applied to the observed signal $\bvy[l,k]$, producing an estimate $z[l,k]$ that best approximates the desired signal at reference. This filtering process is defined by
\begin{equations}
	z[l,k] 
	& = \he{\bvh}[l,k] \bvy[l,k] \\
	& = \he{\bvh}[l,k] \bvd[k] x_1[l,k] + \he{\bvh}[l,k] \bveta[l,k]
\end{equations}

From this, it is clear that the preservation of the desired signal can (theoretically) be achieved through the constraint $\he{\bvh}[l,k] \bvd[k] = 1$; and to ensure the best approximation of the desired signal, the residual noise ($\he{\bvh}\bveta$) should be minimized. Based on this framework, several beamformers can be designed, each utilizing different information about the signals and environment, and aiming for distinct optimization goals.

To exploit the previously estimated $\Corr*{\bveta}$ (\cref{sec:doa_ncm_estimation}), the minimum-variance distortionless response (MVDR) \cite{souden_study_2010} beamformer can be employed. This design preserves the desired signal while minimizing residual noise. The standard MVDR formulation for the beamformer, denoted $\bvh{\mvdr}[k]$, is
\begin{equation}
	\bvh{\mvdr} = \frac{ \Corr*{\bveta} \bvd{} }{ \he{\bvd} \Corr*{\bveta} \bvd{} }
\end{equation}

An alternative approach, which incorporates both the (previously acquired) DoA and NCM estimates, is the linearly-constrained minimum variance (LCMV) beamformer \cite{souden_study_2010}. In addition to the distortionless constraint, it allows the nulling of one (or more) undesired directions. In our case, we aim to use the interfering source's DoA $\bar{\Theta}$ and its steering vector $\bvb[k]$ to cancel $\bvp[l,k]$, the directional portion of the interfering signal $\bvn[l,k]$. For this, we define $\bvC[k]$ as a $\sz{M}{2}$ concatenation matrix,
\begin{equation}
	\bvC = \bts{ \bvd , \bvb }
\end{equation}
and the LCMV beamformer $\bvh{\lcmv}[k]$ is given by
\begin{equation}
	\bvh{\lcmv} = \inv{\Corr*{\bveta}} \bvC \inv*{\he{\bvC} \inv{\Corr*{\bveta}} \bvC} \bvi
\end{equation}
with $\bvi = \tr{[1, 0]}$.

A final beamformer of interest is the linearly-constrained minimum power (LCMP) beamformer, which uses the observed signal’s covariance matrix $\Corr{\bvy}$ instead of $\Corr*{\bveta}$; it is defined as
\begin{equation}
	\bvh{\lcmp} = \inv{\Corr{\bvy}} \bvC \inv*{\he{\bvC} \inv{\Corr{\bvy}} \bvC} \bvi
\end{equation}

Since the LCMP beamformer uses the observed signal’s CM — which can be estimated directly from the data — it is compatible with external DoA estimation methods such as the MUSIC and wMUSIC algorithms presented earlier.

In contrast, the MVDR and LCMV beamformers rely on the proposed NCM and DoA estimates to achieve signal recovery. Theoretically, the LCMV and LCMP beamformers are equivalent, though it is known that LCMP designs are more sensitive to steering errors \cite{vergallo_processing_2012}.


\subsection{Beamformers performance}

The performance of the selected bemformers will be assessed in the scenarios from \cref{subsec:sec3:results_doa_estimation}, each with four beamformers being designed and used: an MVDR, originally proposed with this NCM framework in \cite{moore_compact_2022}, denoted ´´MVDR"; an LCMV, using the modeled NCM and the proposed modeling for the DoA, called ´´LCMV"; and two LCMP, using the MUSIC and wMUSIC DoA estimations as presented in \cref{subsec:sec3:results_doa_estimation}, respectively named ´´LCMP" and ´´wLCMP". NCM (or NCM-based) beamformers will refer to the first two, and MUSIC (or MUSIC-based) beamformers will refer to the last two.

\subsection{Metrics}

In all metrics, the desired signal is only the main planar wave (or direct path) of the desired source's reverberated signal. All considered metrics are in broadband, being measured between the original and filtered signals in the time domain. The subscript $F$ denotes the filtered form of the respective signal. That is, $x_F[l,k] = \he{\bvh}[l,k] \bvx[l,k]$, and the same for all other filtered signals.

We will use the desired signal reduction factor (DSRF) to evaluate the desired signal's distortion, being given by
\begin{equation}
	\dsrf = \frac{\var{x_1}}{\var{x_F}}
\end{equation}

To evaluate the signal enhancement, we will evaluate the gain in SIR, gain in SNR\footnote{Here, SNR will represent the ratio w.r.t. the global noise $\eta$.}. These metrics are, respectively, given by
\begin{subgather}
	\gsnr = \frac{\var{x_F}}{\var{\eta_F}} \inv{\pts{\frac{\var{x_1}}{\var{\eta_1}}}} \\
	\gsir = \frac{\var{x_F}}{\var{u_F}} \inv{\pts{\frac{\var{x_1}}{\var{u_1}}}}
\end{subgather}

Another interesting metric is the Undesired Planar (Wave) Reduction Factor (UPRF). This will measure the beamformer's rejection to the interfering signal direct path (first planar wave) component. This is defined as
\begin{equation}
	\uprf = \frac{\var{x_F}}{\var{p_F}} \inv{\pts{\frac{\var{x_1}}{\var{p_1}}}}
\end{equation}

These three metrics will allow us to compare the performance of the beamformers across the acoustic environment's main signals.

We will use the broadband White-Noise Gain (WNG) and Directivity Factor (DF), to evaluate the beamformers' theoretical performance when exposed to a (purely) Gaussian noise and an ideal isotropic noise field, respectively. These metrics are given by
\begin{subgather}
	\df = \frac{K}{\sum\limits_{k=0}^{K} \he{\bvh}[k] \bvGa[k] \bvh[k]} \\
	\wng = \frac{K}{\sum\limits_{k=0}^{K}\he{\bvh}[k] \bvh[k]}
\end{subgather}
in which $\bvGa[k]$ is the isotropic noise field pseudo-correlation matrix \cite{habets_generating_2007}.

All metrics will be presented in decibels ($\dB$). This unit will be omitted on all figures, for clarity and conciseness. Four beamformers will be compared, and are ordered as follows:
\begin{itemize}
	\item LCMV with the proposed joint DoA and NCM estimation (red), denoted LCMV-NCM or just LCMV;
	\item MVDR using the modeled NCM (yellow, densely dotted), called MVDR-NCM or just MVDR;
	\item LCMP with the conventional MUSIC algorithm (green, dashed), named LCMP-MSC;
	\item and LCMP using the wMUSIC method (blue, dash-dotted), denoted LCMP-wMSC.
\end{itemize} 

\subsection{Beamformer results and discussion}

We present the boxplot results for each evaluation metric and beamformer in \cref{fig:sec4:boxplot_bf_metrics}, for the same simulated conditions as in \cref{tab:sec3:simulation_parameters}. We highlight that the figure has two $\x$-axes: the first three metrics (gSNR, gSIR, UPRF) use the axis on the top, and the last three metrics (DSRF, DF, WNG) use the axis on the bottom.

\input{input/figures/boxplot_filtering_metrics.tex}

\subsubsection*{Noise signal rejection}

Regarding the SNR gain, both NCM-based beamformers outperformed the MUSIC-based alternatives, though the margin was modest. Similarly as in the DSRF, this is related to the NCM modeling, and closely linked to the desired signal's maintenance.

In addition, the proposed LCMV beamformer achieved the highest average suppression of the directional interference, as reflected in the gSIR and UPRF metrics. It consistently surpassed all other beamformers by at least $4\dB$ in these two measures. However, its performance in UPRF was less consistent, with considerable variability and several scenarios where it underperformed relative to the MUSIC-based beamformers. The MVDR beamformer showed the poorest performance in these metrics due to the lack of directional interference suppression, relying solely on global noise minimization.

While \cref{fig:sec4:boxplot_bf_metrics} summarizes overall performance, it does not convey any relationship between the metrics. To provide deeper insight, \cref{fig:sec4:scatter_gsnr_x_gsir__linear_reg__gsnr_x_gsir} presents a scatter plot of $\gsnr \times \gsir$, along with a linear regression fit for each beamformer. Each data point corresponds to a simulation scenario described in \cref{subsec:sec3:results_doa_estimation}, allowing a joint assessment of the trade-offs between these two metrics.

The plot reveals that all beamformers present a positive trend, where higher gSNR generally coincides with higher gSIR. The LCMV beamformer exhibits the most favorable trade-off, achieving better expected performance (per the linear fit) than the MUSIC-based designs across both metrics. It also maintains a gSNR comparable to the MVDR while clearly outperforming it in gSIR.

\input{input/figures/scatterplot__linear_reg__gsnr_x_gsir.tex}

\subsubsection*{Desired signal maintenance}

The DSRF results indicate that the NCM-based beamformers (yellow and red) exhibit significantly lower desired signal distortion compared to their MUSIC-based counterparts. This improvement is attributed to the beamformers design, which excludes the desired signal's covariance matrix, thus minimizing signal distortion. The proposed LCMV beamformer not only maintains this advantage, but also demonstrates a distribution closer to $0\dB$ than the MVDR, albeit with a wider spread of outliers.

\subsubsection*{Theoretical noise field metrics}

Although the LCMV beamformer led in practical performance metrics, the LCMP design demonstrated superior results in regards to theoretical noise field responses. For both evaluated theoretical metrics, the LCMP beamformer achieved the best average outcomes, with the LCMV following closely. Interestingly, the proposed LCMV achieved a higher WNG performance compared to LCMP, though its mean value was slightly lower. In contrast, the wLCMP method performed poorly across both metrics, often amplifying the output under theoretical noise conditions.

\subsubsection*{Per-angle signal enhancement}

While \cref{fig:sec4:boxplot_bf_metrics} presents results encompassing all angles, \cref{fig:sec4:boxplot_bf_metrics_per-dir} displays the noise rejection metrics (gSNR, gSIR, and UPRF) separated by each undesired source's DoA. The left axis indicates the metric values, while the right axis shows the corresponding DoA angles.

We observe that, across all incoming angles, the gSNR results are very similar to each other and closely match the global outcomes shown in \cref{fig:sec4:boxplot_bf_metrics}, with the LCMV and MVDR beamformers performing slightly better when the interfering source arrives from a wider angle.

In terms of gSIR, the LCMV beamformer matches the MUSIC-based ones in the worst-case scenario and significantly outperforms them in the other two cases. It also consistently surpasses the MVDR, although the performance gap narrows as the angle widens.

Finally, in the UPRF the proposed LCMV filter achieves the best performance by a considerable margin for the $50\dg$ and $80\dg$ scenarios, but performs poorly in the $20\dg$ case. This underperformance is closely tied to its challenges in accurately estimating the DoA in this specific scenario, as thoroughly discussed in \cref{subsec:sec3:results_doa_estimation}.

\input{input/figures/boxplot_filtering_metrics_per-dir.tex}

\subsubsection*{General signal enhancement discussion}

Overall, \cref{fig:sec4:boxplot_bf_metrics,fig:sec4:boxplot_bf_metrics_per-dir} show that the proposed LCMV beamformer generally outperforms the other designs, for all metrics and DoA angles. It combines strong desired signal preservation and overall enhancement (comparable to the MVDR) with clearly superior directional interference rejection, compared to the null-steering beamformers.

In the theoretical metrics, the LCMV beamformer again surpassed the MVDR, though it remained behind the LCMP in average performance. Despite sharing the same NCM model foundation, the proposed LCMV notably outperformed the MVDR across nearly all metrics, consistently delivering equal or superior performance.